<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI City Chat Interface - Test Mode</title>
    <link rel="stylesheet" href="css/ai_city_chat.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .test-banner {
            background: linear-gradient(90deg, #f59e0b, #d97706);
            color: white;
            padding: 0.5rem;
            text-align: center;
            font-weight: 600;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <div class="test-banner">
        🧪 TEST MODE - This demo works without AI City server connection
    </div>

    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1 class="app-title">AI City Chat (Test)</h1>
                <div class="connection-status" id="connectionStatus">
                    <div class="status-indicator connected" id="statusIndicator"></div>
                    <span id="statusText">Test Mode Active</span>
                </div>
            </div>
            <div class="header-right">
                <button class="theme-toggle" id="themeToggle" title="Toggle theme">
                    <span class="theme-icon">🌙</span>
                </button>
                <button class="info-button" id="infoButton" title="Show services">
                    <span>ℹ️</span>
                </button>
            </div>
        </header>

        <!-- Main Chat Area -->
        <main class="main-content">
            <!-- Sidebar with services info -->
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <h3>Available Services</h3>
                    <button class="close-sidebar" id="closeSidebar">×</button>
                </div>
                <div class="services-list" id="servicesList">
                    <div class="service-item">
                        <div class="service-name">🤖 AI Orchestration</div>
                        <div class="service-description">Central coordination of AI agents</div>
                    </div>
                    <div class="service-item">
                        <div class="service-name">🔍 Research Agent</div>
                        <div class="service-description">Information gathering and analysis</div>
                    </div>
                    <div class="service-item">
                        <div class="service-name">📚 Knowledge Base</div>
                        <div class="service-description">Document storage and retrieval</div>
                    </div>
                    <div class="service-item">
                        <div class="service-name">🛠️ Tool Integration</div>
                        <div class="service-description">External tool management</div>
                    </div>
                </div>
                <div class="api-info">
                    <h4>API Information</h4>
                    <div class="info-item">
                        <strong>Status:</strong> Test Mode (No Server Required)
                    </div>
                    <div class="info-item">
                        <strong>Demo:</strong> Simulated AI responses
                    </div>
                </div>
            </aside>

            <!-- Chat Container -->
            <div class="chat-container">
                <div class="chat-messages" id="chatMessages">
                    <div class="welcome-message">
                        <div class="welcome-icon">🏙️</div>
                        <h2>Welcome to AI City Test Mode</h2>
                        <p>This is a demonstration of the chat interface. Try typing a message below to see simulated AI responses!</p>
                    </div>
                </div>

                <!-- Typing indicator -->
                <div class="typing-indicator" id="typingIndicator">
                    <div class="typing-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                    <span class="typing-text">AI is thinking...</span>
                </div>

                <!-- Message Input -->
                <div class="message-input-container">
                    <div class="input-wrapper">
                        <textarea
                            id="messageInput"
                            placeholder="Type your message to test the interface..."
                            rows="1"
                            maxlength="2000"></textarea>
                        <button id="sendButton" class="send-button" disabled>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22,2 15,22 11,13 2,9"></polygon>
                            </svg>
                        </button>
                    </div>
                    <div class="input-footer">
                        <div class="character-count" id="characterCount">0/2000</div>
                        <div class="quick-actions">
                            <button class="quick-action" id="clearChat" title="Clear chat">🗑️</button>
                            <button class="quick-action" id="exportChat" title="Export chat">💾</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Simplified test version of the chat interface
        class TestAICityChat {
            constructor() {
                this.messageHistory = [];
                this.isTyping = false;
                this.responseTemplates = [
                    "Hello! I'm a simulated AI agent from AI City. How can I help you today?",
                    "That's an interesting question! In a real scenario, I would process your request through our AI orchestration system.",
                    "I understand you're asking about {topic}. Our research agents would typically gather comprehensive information on this topic.",
                    "Thank you for testing the interface! In production, this message would be handled by one of our 8 specialized agents.",
                    "The AI City chat interface is working perfectly! Your message has been received and would normally be processed by our advanced AI systems.",
                    "Great question! Our knowledge base would search through extensive documentation to provide you with accurate information.",
                    "I notice you're interested in {topic}. Our analytics agents would provide detailed insights on this subject.",
                    "This is a demonstration response showing how the chat interface handles AI replies with proper formatting and timing."
                ];

                this.init();
            }

            init() {
                this.initializeElements();
                this.setupEventListeners();
                this.loadTheme();
                this.setupAutoResize();
            }

            initializeElements() {
                this.elements = {
                    themeToggle: document.getElementById('themeToggle'),
                    infoButton: document.getElementById('infoButton'),
                    sidebar: document.getElementById('sidebar'),
                    closeSidebar: document.getElementById('closeSidebar'),
                    chatMessages: document.getElementById('chatMessages'),
                    typingIndicator: document.getElementById('typingIndicator'),
                    messageInput: document.getElementById('messageInput'),
                    sendButton: document.getElementById('sendButton'),
                    characterCount: document.getElementById('characterCount'),
                    clearChat: document.getElementById('clearChat'),
                    exportChat: document.getElementById('exportChat')
                };
            }

            setupEventListeners() {
                this.elements.themeToggle.addEventListener('click', () => this.toggleTheme());
                this.elements.infoButton.addEventListener('click', () => this.toggleSidebar());
                this.elements.closeSidebar.addEventListener('click', () => this.closeSidebar());

                this.elements.messageInput.addEventListener('input', () => {
                    this.updateCharacterCount();
                    this.updateSendButton();
                    this.autoResizeTextarea();
                });

                this.elements.messageInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });

                this.elements.sendButton.addEventListener('click', () => this.sendMessage());
                this.elements.clearChat.addEventListener('click', () => this.clearChat());
                this.elements.exportChat.addEventListener('click', () => this.exportChat());

                document.addEventListener('click', (e) => {
                    if (this.elements.sidebar.classList.contains('open') &&
                        !this.elements.sidebar.contains(e.target) &&
                        !this.elements.infoButton.contains(e.target)) {
                        this.closeSidebar();
                    }
                });
            }

            async sendMessage() {
                const message = this.elements.messageInput.value.trim();
                if (!message) return;

                this.addMessage('user', message);
                this.elements.messageInput.value = '';
                this.updateCharacterCount();
                this.updateSendButton();
                this.autoResizeTextarea();

                this.showTypingIndicator();

                // Simulate AI response delay
                setTimeout(() => {
                    this.hideTypingIndicator();
                    const response = this.generateResponse(message);
                    this.addMessage('ai', response, 'Test Agent');
                }, 1000 + Math.random() * 2000);
            }

            generateResponse(userMessage) {
                const randomTemplate = this.responseTemplates[Math.floor(Math.random() * this.responseTemplates.length)];

                // Simple topic extraction for demonstration
                const topic = userMessage.split(' ').find(word => word.length > 4) || 'your topic';

                return randomTemplate.replace('{topic}', topic);
            }

            addMessage(type, content, sender = null) {
                const messageData = {
                    type,
                    content,
                    sender,
                    timestamp: new Date()
                };

                this.messageHistory.push(messageData);

                const messageElement = document.createElement('div');
                messageElement.className = `message ${type}`;

                const messageContent = document.createElement('div');
                messageContent.className = 'message-content';
                messageContent.textContent = content;

                const messageMeta = document.createElement('div');
                messageMeta.className = 'message-meta';

                const timeString = messageData.timestamp.toLocaleTimeString([], {
                    hour: '2-digit',
                    minute: '2-digit'
                });

                if (type === 'ai' && sender) {
                    messageMeta.textContent = `${sender} • ${timeString}`;
                } else {
                    messageMeta.textContent = timeString;
                }

                messageElement.appendChild(messageContent);
                messageElement.appendChild(messageMeta);

                const welcomeMessage = this.elements.chatMessages.querySelector('.welcome-message');
                if (welcomeMessage) {
                    welcomeMessage.remove();
                }

                this.elements.chatMessages.appendChild(messageElement);
                this.scrollToBottom();
            }

            showTypingIndicator() {
                this.isTyping = true;
                this.elements.typingIndicator.classList.add('show');
                this.scrollToBottom();
            }

            hideTypingIndicator() {
                this.isTyping = false;
                this.elements.typingIndicator.classList.remove('show');
            }

            scrollToBottom() {
                requestAnimationFrame(() => {
                    this.elements.chatMessages.scrollTop = this.elements.chatMessages.scrollHeight;
                });
            }

            updateCharacterCount() {
                const length = this.elements.messageInput.value.length;
                this.elements.characterCount.textContent = `${length}/2000`;
            }

            updateSendButton() {
                const hasText = this.elements.messageInput.value.trim().length > 0;
                this.elements.sendButton.disabled = !hasText;
            }

            autoResizeTextarea() {
                const textarea = this.elements.messageInput;
                textarea.style.height = 'auto';
                const newHeight = Math.min(textarea.scrollHeight, 120);
                textarea.style.height = newHeight + 'px';
            }

            setupAutoResize() {
                this.autoResizeTextarea();
                this.updateSendButton();
                this.updateCharacterCount();
            }

            toggleTheme() {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('ai-city-theme', newTheme);

                const icon = this.elements.themeToggle.querySelector('.theme-icon');
                icon.textContent = newTheme === 'dark' ? '☀️' : '🌙';
            }

            loadTheme() {
                const savedTheme = localStorage.getItem('ai-city-theme') || 'light';
                document.documentElement.setAttribute('data-theme', savedTheme);

                const icon = this.elements.themeToggle.querySelector('.theme-icon');
                icon.textContent = savedTheme === 'dark' ? '☀️' : '🌙';
            }

            toggleSidebar() {
                this.elements.sidebar.classList.add('open');
            }

            closeSidebar() {
                this.elements.sidebar.classList.remove('open');
            }

            clearChat() {
                if (confirm('Are you sure you want to clear the chat history?')) {
                    this.messageHistory = [];
                    this.elements.chatMessages.innerHTML = `
                        <div class="welcome-message">
                            <div class="welcome-icon">🏙️</div>
                            <h2>Welcome to AI City Test Mode</h2>
                            <p>This is a demonstration of the chat interface. Try typing a message below to see simulated AI responses!</p>
                        </div>
                    `;
                }
            }

            exportChat() {
                if (this.messageHistory.length === 0) {
                    alert('No messages to export.');
                    return;
                }

                const exportData = {
                    timestamp: new Date().toISOString(),
                    mode: 'test',
                    messages: this.messageHistory,
                    totalMessages: this.messageHistory.length
                };

                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });

                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `ai-city-chat-test-${new Date().toISOString().split('T')[0]}.json`;

                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        // Initialize the test chat application
        const testChat = new TestAICityChat();
    </script>
</body>
</html>